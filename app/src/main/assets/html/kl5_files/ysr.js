YSR={};YSR.VERSION="v_0_2_0";YSR.util={};YSR.util.cookie={get:function(b){var a=document.cookie.match(new RegExp(".*"+b+"=([^;]+);?"));return a?a[1]:""},set:function(b,d,a){var c=b+"="+encodeURIComponent(d);if(typeof a==="number"){c+="; max-age="+a}document.cookie=c+"; path=/"}};YSR.user={isLoggedIn:function(){return YSR.util.cookie.get("username")?true:false},extendLogin:function(){var a=YSR.util.cookie.get("username");if(!a){return false}YSR.util.cookie.set("username",a,15*60);return true}};YSR.ui={_$frmLogin:$("#frmLogin"),_$frmAdd:$("#frmAdd"),showLogin:function(){var a=this;this._$frmLogin.addClass("visible");setTimeout(function(){a._$frmLogin.find(".username").focus()},600)},hideLogin:function(){this._$frmLogin.find(".msg").text("");this._$frmLogin.find("input").val("");this._$frmLogin.removeClass("visible")},showAdd:function(){this._$frmAdd.addClass("visible")},hideAdd:function(){this._$frmAdd.removeClass("visible")}};(function(){var a=$("#spinner");$(document).on({ajaxStart:function(){a.fadeIn()},ajaxStop:function(){a.fadeOut("fast")}})})();var YSR=YSR||{};YSR.M={};YSR.M.Topic=Backbone.Model.extend({defaults:{id:0,title:"",subs:0}});YSR.M.StoryTitle=Backbone.Model.extend({defaults:{id:0,parentId:0,title:""}});YSR.M.Story=Backbone.Model.extend({defaults:{id:0,title:"",content:""},initialize:function(){var a=this;this.on("change",function(){var b=new YSR.V.Story({model:a});b.render()})}});YSR.M.Title=Backbone.Model.extend({defaults:{id:0,name:""},initialize:function(){var a=this;this.on("change:name",function(){var b=new YSR.V.Title({model:a});b.render()})},url:function(){return YSR.VERSION+"/topics/title/"+this.id}});var YSR=YSR||{};YSR.V={};YSR.V.Topic=Backbone.View.extend({tagName:"li",render:function(){var a=(this.model.get("subs")>0)?"#!topics/"+this.model.get("id"):"#!topics/"+this.model.get("id")+"/stories";var b=$('<a href="'+a+'">'+this.model.get("title")+"</a>");this.$el.append(b);return this}});YSR.V.StoryTitle=Backbone.View.extend({tagName:"li",initialize:function(a){this.path=a.path},render:function(){var a=$("<a href='#!"+this.path+"'>"+this.model.get("title")+"</a>");this.$el.append(a);return this}});YSR.V.Story=Backbone.View.extend({tagName:"section",tpl:$("#storyTpl").html(),render:function(){var a=_.template(this.tpl);this.$el.html(a(this.model.toJSON()));$("#content").empty().append(this.$el);return this}});YSR.V.Stories=Backbone.View.extend({tagName:"ul",render:function(){var a=this;this.collection.forEach(function(c){var b=new YSR.V.StoryTitle({model:c,path:a.collection.url.replace(YSR.VERSION+"/","")+"/"+c.get("id")});a.$el.append(b.render().el)});$("#content").empty().append(this.el);return this}});YSR.V.Title=Backbone.View.extend({tagName:"h3",render:function(){this.$el.text(this.model.get("name"));$("#title").empty().append(this.el)}});var YSR=YSR||{};YSR.C={};YSR.C.Topics=Backbone.Collection.extend({model:YSR.M.Topic,initialize:function(){var a=this;this.on("add",function(){var b=$("<ul>");a.forEach(function(d){var c=new YSR.V.Topic({model:d});b.append(c.render().el)});$("#content").empty().append(b)})}});YSR.C.Stories=Backbone.Collection.extend({model:YSR.M.Story,initialize:function(){var a=this;this.on("reset",function(){var b=new YSR.V.Stories({collection:a});b.render()})}});var YSR=YSR||{};YSR.R={};YSR.R.Router=Backbone.Router.extend({routes:{"!topics":"getHeadTopics","!topics/:id":"getSubTopics","!topics/:id/stories":"getStories","!topics/:topicId/stories/:id":"getStory","*other":"goHome"},getHeadTopics:function(){var b=new YSR.C.Topics();b.url=YSR.VERSION+"/topics/";b.fetch();var a=new YSR.M.Title();a.set("name",".  .")},getSubTopics:function(a){},getStories:function(c){var b=new YSR.C.Stories();b.url=YSR.VERSION+"/topics/"+c+"/stories";b.fetch({reset:true});var a=new YSR.M.Title({id:c});a.fetch()},getStory:function(b,d){var a=new YSR.M.Story({id:d});a.url=YSR.VERSION+"/topics/"+b+"/stories/"+d;a.fetch();var c=new YSR.M.Title({id:b});c.fetch()},goHome:function(){this.navigate("!topics",{trigger:true})}});(function(){new YSR.R.Router();Backbone.history.start();$("#prev").click(function(f){window.history.back()});$(window).on("hashchange",function(){$(document).scrollTop(0)});var b=$("#meaning"),a=$("#frmAdd"),c=a.find(".word"),d=a.find(".meaning"),e=$("#frmLogin");$(document).on("click","#content p span",function(){var j=$(this).addClass("active");b.hide().text(j.data("m"));var i=j.offset().top-b.outerHeight()-10,g=j.offset().left,f=$(window).width(),k=b.outerWidth(),h=(f>(g+k))?g:f-k-10;b.css({top:i,left:h}).stop(false,true).fadeIn("fast").delay(2500).fadeOut("slow",function(){j.removeClass("active")})});b.click(function(){var f=$("#content p span.active");var h=f.text();var g=f.data("m");c.val(h);d.val(g);YSR.ui.showAdd()});a.on("submit",function(g){g.preventDefault();var f="/vocab/v_2_4_0/apps/addWord.php";YSR.ui.hideAdd();$.ajax({url:f,type:"post",dataType:"json",global:false,data:{word:c.val(),meaning:d.val()}}).done(function(){YSR.user.extendLogin()}).fail(function(h){if(h.responseText.indexOf("INVALID_USER")>-1){YSR.ui.showLogin()}else{alert("Error Saving Data!")}})});a.find(".cancel").click(function(f){f.preventDefault();YSR.ui.hideAdd()});$("#login").click(function(){YSR.ui.showLogin()});e.on("submit",function(h){h.preventDefault();var i=e.find(".username").val(),g=e.find(".password").val();if($.trim(i)===""||$.trim(g)===""){return}e.find(".msg").text("");var f="/login/login.php";$.ajax({url:f,type:"post",dataType:"json",data:{username:i,password:g}}).done(function(){YSR.ui.hideLogin();YSR.util.cookie.set("username",i,15*60)}).fail(function(){e.find(".msg").text("Error Logging In!")})});e.find(".cancel").click(function(f){f.preventDefault();YSR.ui.hideLogin()})})();